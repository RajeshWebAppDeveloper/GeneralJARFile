--
-- PostgreSQL database dump
--

-- Dumped from database version 16.4
-- Dumped by pg_dump version 16.4

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- Name: customer_cars_info_list; Type: TYPE; Schema: public; Owner: postgres
--

CREATE TYPE public.customer_cars_info_list AS (
	id uuid,
	brand character varying,
	car_name character varying,
	car_no character varying,
	is_ac character varying,
	img_url character varying,
	category character varying,
	no_of_seat character varying,
	is_gps character varying,
	transmission_type character varying,
	fuel_type character varying,
	limit_km character varying,
	price_per_day character varying
);


ALTER TYPE public.customer_cars_info_list OWNER TO postgres;

--
-- Name: customer_cars_rent_price_details; Type: TYPE; Schema: public; Owner: postgres
--

CREATE TYPE public.customer_cars_rent_price_details AS (
	id uuid,
	car_rent_charges numeric,
	delivery_charges numeric,
	total_payable numeric
);


ALTER TYPE public.customer_cars_rent_price_details OWNER TO postgres;

--
-- Name: getcustomerbookingcalculatepayment(character varying, character varying, character varying, character varying); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.getcustomerbookingcalculatepayment(cfromdate character varying, ctodate character varying, ccarnumber character varying, cpicktype character varying) RETURNS SETOF public.customer_cars_rent_price_details
    LANGUAGE plpgsql
    AS $$

DECLARE
    -- Declare variables

    customerCarsRentPriceDetails customer_cars_rent_price_details;
    noOfCustomerBookingDays NUMERIC := 0;
    carRentPricePerDay NUMERIC := 0;
    holidayCarAdditionalChargesPercent NUMERIC := 0;
    multipleDayCarAdditionalChargesPercent NUMERIC := 0;
    totalBookingPrice NUMERIC := 0;
    deliveryAmount NUMERIC := 0;
    finalPrice NUMERIC := 0;

BEGIN
    /****************************** GET VALUE: NO OF BOOKING DAYS ****************************************/
    SELECT 
        (cToDate::DATE - cFromDate::DATE) + 1
    INTO 
        noOfCustomerBookingDays;

    /****************************** GET VALUE: CAR PRICE PER DAY ****************************************/
    SELECT 
        rcd.price_per_day::NUMERIC
    INTO 
        carRentPricePerDay
    FROM 
        admin_rental_cars_details rcd
    WHERE 
        rcd.car_no = cCarNumber;

    /****************************** PRICE CALCULATION ****************************************/
    IF noOfCustomerBookingDays = 1 THEN
        -- For single day booking, get additional charges
        SELECT 
            ps.car_rent_amount_additional_percentage::NUMERIC
        INTO 
            holidayCarAdditionalChargesPercent
        FROM 
            admin_view_holiday_car_booking_payment_rule ps
        WHERE 
            TO_CHAR(ps.holiday_date, 'DD/MM/YYYY') = TO_CHAR(cFromDate::DATE, 'DD/MM/YYYY');
        
        -- Calculate total price with additional charges
        totalBookingPrice := carRentPricePerDay + (carRentPricePerDay * holidayCarAdditionalChargesPercent / 100);

        RAISE NOTICE 'TOTAL BOOKING PRICE FOR 1 DAY: %', totalBookingPrice;

    ELSIF noOfCustomerBookingDays > 1 THEN
    SELECT 
            ps.car_rent_amount_additional_percentage::NUMERIC
        INTO 
            multipleDayCarAdditionalChargesPercent
        FROM 
            admin_view_multiple_day_car_booking_payment_rule ps
        WHERE 
            ps.no_of_days::NUMERIC = noOfCustomerBookingDays;
        -- For multiple days, just multiply by the number of days
        totalBookingPrice := ((carRentPricePerDay * noOfCustomerBookingDays) + (carRentPricePerDay * multipleDayCarAdditionalChargesPercent/ 100));
        
        RAISE NOTICE 'TOTAL BOOKING PRICE FOR MULTIPLE DAYS: %', totalBookingPrice;
    END IF;

    /****************************** DELIVERY CHARGES ****************************************/
    IF lower(cPickType) = lower('delivery') THEN
        deliveryAmount := 500;
    ELSE
    deliveryAmount := 300;
    END IF;
    
    RAISE NOTICE 'DELIVERY CHARGES: %', deliveryAmount;

    -- Calculate final price (total price + delivery amount)
    finalPrice := totalBookingPrice + deliveryAmount;

    FOR customerCarsRentPriceDetails IN
SELECT 
uuid_generate_v4() as id
,COALESCE(round(totalBookingPrice),0) as car_rent_charges
            ,COALESCE(deliveryAmount,0) as delivery_charges
            ,COALESCE(round(finalPrice),0) as total_payable

LOOP 

RETURN NEXT customerCarsRentPriceDetails;

END LOOP;
    

END;

$$;


ALTER FUNCTION public.getcustomerbookingcalculatepayment(cfromdate character varying, ctodate character varying, ccarnumber character varying, cpicktype character varying) OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: admin_rental_cars_details; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.admin_rental_cars_details (
    id uuid NOT NULL,
    brand character varying(255),
    car_name character varying(255),
    car_no character varying(255),
    is_ac character varying(255),
    img_url character varying(255),
    category character varying(255),
    no_of_seat character varying(255),
    is_gps character varying(255),
    transmission_type character varying(255),
    fuel_type character varying(255),
    limit_km character varying(255),
    price_per_day character varying(255),
    feul_type character varying(255)
);


ALTER TABLE public.admin_rental_cars_details OWNER TO postgres;

--
-- Name: getcustomerbookingdetailslist(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.getcustomerbookingdetailslist() RETURNS SETOF public.admin_rental_cars_details
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT *
    FROM admin_rental_cars_details limit 1;
    
END;
$$;


ALTER FUNCTION public.getcustomerbookingdetailslist() OWNER TO postgres;

--
-- Name: getrentaridecustomercarslist(character varying, character varying, character varying, character varying); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.getrentaridecustomercarslist(categoryargs character varying, fueltype character varying, transmissiontype character varying, kmlimit character varying) RETURNS SETOF public.customer_cars_info_list
    LANGUAGE plpgsql
    AS $$

DECLARE
customerCarsInfoList customer_cars_info_list;

BEGIN
FOR customerCarsInfoList IN
SELECT 
m2.id 
,m2.brand
,m2.car_name
,m2.car_no 
,m2.is_ac 
,m1.file_name as img_url
,m2.category
,m2.no_of_seat
,m2.is_gps 
,m2.transmission_type
,m2.fuel_type 
,m2.limit_km 
,m2.price_per_day
FROM
admin_rental_cars_upload m1
,admin_rental_cars_details m2
WHERE
m1.id = m2.id
AND m2.car_name is  NOT NUll
AND lower(m2.category) like lower(categoryArgs)||'%'
AND lower(m2.fuel_type) like lower(fuelType)||'%'
AND lower(m2.transmission_type) like lower(transmissionType)||'%'
AND lower(m2.limit_km) like lower(kmLimit)||'%'


LOOP 

RETURN NEXT customerCarsInfoList;

END LOOP;
END

$$;


ALTER FUNCTION public.getrentaridecustomercarslist(categoryargs character varying, fueltype character varying, transmissiontype character varying, kmlimit character varying) OWNER TO postgres;

--
-- Name: admin_cars_category_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.admin_cars_category_seq
    START WITH 1
    INCREMENT BY 50
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.admin_cars_category_seq OWNER TO postgres;

--
-- Name: admin_default_properties; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.admin_default_properties (
    id uuid NOT NULL,
    property_name character varying(255),
    property_value character varying(255)
);


ALTER TABLE public.admin_default_properties OWNER TO postgres;

--
-- Name: admin_rental_cars_upload; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.admin_rental_cars_upload (
    id uuid NOT NULL,
    file_path character varying(255),
    file_name character varying(255),
    file_type character varying(255),
    convert_into_png_status character varying(255)
);


ALTER TABLE public.admin_rental_cars_upload OWNER TO postgres;

--
-- Name: admin_software_user_details; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.admin_software_user_details (
    user_id character varying(255) NOT NULL,
    password character varying(255),
    email_id character varying(255),
    mobile_no character varying(255)
);


ALTER TABLE public.admin_software_user_details OWNER TO postgres;

--
-- Name: admin_view_holiday_car_booking_payment_rule; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.admin_view_holiday_car_booking_payment_rule (
    id uuid NOT NULL,
    holiday_date timestamp(6) without time zone,
    car_rent_amount_additional_percentage character varying(255)
);


ALTER TABLE public.admin_view_holiday_car_booking_payment_rule OWNER TO postgres;

--
-- Name: admin_view_multiple_day_car_booking_payment_rule; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.admin_view_multiple_day_car_booking_payment_rule (
    id uuid NOT NULL,
    no_of_days character varying(255),
    car_rent_amount_additional_percentage character varying(255)
);


ALTER TABLE public.admin_view_multiple_day_car_booking_payment_rule OWNER TO postgres;

--
-- Name: cars; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.cars (
    brand character varying(255),
    model character varying(255),
    year character varying(255),
    email_id character varying(255),
    mobile_no character varying(255),
    password character varying(255)
);


ALTER TABLE public.cars OWNER TO postgres;

--
-- Name: cars_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.cars_seq
    START WITH 1
    INCREMENT BY 50
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.cars_seq OWNER TO postgres;

--
-- Name: customer_booking_documents_details; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.customer_booking_documents_details (
    id uuid NOT NULL,
    customer_name character varying(255),
    mobile_no character varying(255),
    email_id character varying(255),
    document_type character varying(255),
    docuent_number character varying,
    name_on_document character varying(255),
    file_path character varying(255),
    file_name character varying(255),
    file_type character varying(255),
    document_number character varying(255)
);


ALTER TABLE public.customer_booking_documents_details OWNER TO postgres;

--
-- Name: customer_car_rent_booking_details; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.customer_car_rent_booking_details (
    id uuid NOT NULL,
    created_date date,
    customer_name character varying(255),
    mobile_no character varying(255),
    email_id character varying(255),
    car_no character varying(255),
    car_name character varying(255),
    from_date date,
    to_date date,
    pick_up_type character varying(255),
    delivery_or_pickup_charges integer,
    car_rent_charges integer,
    total_payable integer,
    approve_status character varying(255),
    car_img_name character varying(255)
);


ALTER TABLE public.customer_car_rent_booking_details OWNER TO postgres;

--
-- Name: customer_cars_rent_price_details_type; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.customer_cars_rent_price_details_type (
    id uuid NOT NULL,
    car_rent_charges integer NOT NULL,
    delivery_charges character varying(255),
    total_payable character varying(255)
);


ALTER TABLE public.customer_cars_rent_price_details_type OWNER TO postgres;

--
-- Name: customer_registration_details; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.customer_registration_details (
    id uuid,
    name character varying(255),
    password character varying(255),
    mobile_no character varying(255),
    alternative_mobile_no character varying(255),
    age character varying(255),
    email_id character varying(255),
    sign_status character varying(255)
);


ALTER TABLE public.customer_registration_details OWNER TO postgres;

--
-- Name: driver_job_request; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.driver_job_request (
    id uuid NOT NULL,
    requester_name character varying,
    requester_contact character varying,
    message text
);


ALTER TABLE public.driver_job_request OWNER TO postgres;

--
-- Data for Name: admin_default_properties; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.admin_default_properties (id, property_name, property_value) FROM stdin;
219ea9d9-e535-44b4-a826-d3d9af6efa5d	Branch	Chennai,Thiruvallur,Madurai,Trichy,Selam
06c9aa96-a706-4adc-9722-2ce164299c2f	Category	Hatchback,SUV,MUV,luxury,Sedan
\.


--
-- Data for Name: admin_rental_cars_details; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.admin_rental_cars_details (id, brand, car_name, car_no, is_ac, img_url, category, no_of_seat, is_gps, transmission_type, fuel_type, limit_km, price_per_day, feul_type) FROM stdin;
b23dea8e-bcc3-4bfd-92a2-6a3efe5470ab	BMW	BMW x3	VW 67 JH 7878	Yes	b23dea8e-bcc3-4bfd-92a2-6a3efe5470ab_bmw-offer.png	Sedan	5	Yes	Automatic	Petrol	500 KM	1000	\N
1cc7b4ee-410e-46f7-bcdc-9d7c9455980d	honda	shine	RA 78 HQ 2343	Yes	1cc7b4ee-410e-46f7-bcdc-9d7c9455980d_mercedes-offer.png		5	Yes	Automatic	Diesel	320 KM	5000	\N
efe5e5b1-ece8-4247-a9cf-7817cc06b874	adf	asdf	AN 98 BH 9879	Yes	efe5e5b1-ece8-4247-a9cf-7817cc06b874_nissan-offer.png	Sedan	5	Yes	Automatic	Diesel	320 KM	10000	\N
375db3e0-2cd1-4563-a232-a157cbdb5522	BMW	X4	MH 78 BQ 7898	Yes	375db3e0-2cd1-4563-a232-a157cbdb5522_offer-toyota.png	MUV	5	No	Automatic	Diesel	140 KM	40000	\N
20311581-9b00-4ab9-9fcb-5320651ffe0b	asdf	asdf	97989889	Yes	20311581-9b00-4ab9-9fcb-5320651ffe0b_tesla.png	Hatchback	5	Yes	Automatic	Petrol	140 KM	30000	\N
\.


--
-- Data for Name: admin_rental_cars_upload; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.admin_rental_cars_upload (id, file_path, file_name, file_type, convert_into_png_status) FROM stdin;
b23dea8e-bcc3-4bfd-92a2-6a3efe5470ab	C:/Users/Lenovo/Desktop/uploads/	b23dea8e-bcc3-4bfd-92a2-6a3efe5470ab_bmw-offer.png	image/png	true
1cc7b4ee-410e-46f7-bcdc-9d7c9455980d	C:/Users/Lenovo/Desktop/uploads/	1cc7b4ee-410e-46f7-bcdc-9d7c9455980d_mercedes-offer.png	image/png	true
efe5e5b1-ece8-4247-a9cf-7817cc06b874	C:/Users/Lenovo/Desktop/uploads/	efe5e5b1-ece8-4247-a9cf-7817cc06b874_nissan-offer.png	image/png	true
375db3e0-2cd1-4563-a232-a157cbdb5522	C:/Users/Lenovo/Desktop/uploads/	375db3e0-2cd1-4563-a232-a157cbdb5522_offer-toyota.png	image/png	true
20311581-9b00-4ab9-9fcb-5320651ffe0b	C:/Users/Lenovo/Desktop/uploads/	20311581-9b00-4ab9-9fcb-5320651ffe0b_tesla.png	image/jpeg	true
\.


--
-- Data for Name: admin_software_user_details; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.admin_software_user_details (user_id, password, email_id, mobile_no) FROM stdin;
admin	123	rajesh@smartyuppies.com	9090909090
\.


--
-- Data for Name: admin_view_holiday_car_booking_payment_rule; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.admin_view_holiday_car_booking_payment_rule (id, holiday_date, car_rent_amount_additional_percentage) FROM stdin;
d0f55fde-d8aa-4bc0-b487-9949d34b2d54	2024-09-13 16:41:00	12
\.


--
-- Data for Name: admin_view_multiple_day_car_booking_payment_rule; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.admin_view_multiple_day_car_booking_payment_rule (id, no_of_days, car_rent_amount_additional_percentage) FROM stdin;
ab692ebd-ac8d-4116-98ee-bb4bd6fd01f9	2	5
5f250527-7e80-4897-9672-11ce1b52430e	3	10
\.


--
-- Data for Name: cars; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.cars (brand, model, year, email_id, mobile_no, password) FROM stdin;
BMW	X7	2010	\N	\N	\N
BMW	X5	2008	\N	\N	\N
\.


--
-- Data for Name: customer_booking_documents_details; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.customer_booking_documents_details (id, customer_name, mobile_no, email_id, document_type, docuent_number, name_on_document, file_path, file_name, file_type, document_number) FROM stdin;
\.


--
-- Data for Name: customer_car_rent_booking_details; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.customer_car_rent_booking_details (id, created_date, customer_name, mobile_no, email_id, car_no, car_name, from_date, to_date, pick_up_type, delivery_or_pickup_charges, car_rent_charges, total_payable, approve_status, car_img_name) FROM stdin;
\.


--
-- Data for Name: customer_cars_rent_price_details_type; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.customer_cars_rent_price_details_type (id, car_rent_charges, delivery_charges, total_payable) FROM stdin;
\.


--
-- Data for Name: customer_registration_details; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.customer_registration_details (id, name, password, mobile_no, alternative_mobile_no, age, email_id, sign_status) FROM stdin;
8cf91fdd-02a9-4336-a950-a6e8ef637260	Rajesh	8989	8989898989				active
\.


--
-- Data for Name: driver_job_request; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.driver_job_request (id, requester_name, requester_contact, message) FROM stdin;
\.


--
-- Name: admin_cars_category_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.admin_cars_category_seq', 1, true);


--
-- Name: cars_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.cars_seq', 1, false);


--
-- Name: admin_default_properties admin_default_properties_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.admin_default_properties
    ADD CONSTRAINT admin_default_properties_pkey PRIMARY KEY (id);


--
-- Name: admin_rental_cars_details admin_rental_cars_details_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.admin_rental_cars_details
    ADD CONSTRAINT admin_rental_cars_details_pkey PRIMARY KEY (id);


--
-- Name: admin_rental_cars_upload admin_rental_cars_upload_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.admin_rental_cars_upload
    ADD CONSTRAINT admin_rental_cars_upload_pkey PRIMARY KEY (id);


--
-- Name: admin_software_user_details admin_software_user_details_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.admin_software_user_details
    ADD CONSTRAINT admin_software_user_details_pkey PRIMARY KEY (user_id);


--
-- Name: admin_view_holiday_car_booking_payment_rule admin_view_holiday_car_booking_payment_rule_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.admin_view_holiday_car_booking_payment_rule
    ADD CONSTRAINT admin_view_holiday_car_booking_payment_rule_pkey PRIMARY KEY (id);


--
-- Name: admin_view_multiple_day_car_booking_payment_rule admin_view_multiple_day_car_booking_payment_rule_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.admin_view_multiple_day_car_booking_payment_rule
    ADD CONSTRAINT admin_view_multiple_day_car_booking_payment_rule_pkey PRIMARY KEY (id);


--
-- Name: customer_booking_documents_details customer_booking_documents_details_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.customer_booking_documents_details
    ADD CONSTRAINT customer_booking_documents_details_pkey PRIMARY KEY (id);


--
-- Name: customer_car_rent_booking_details customer_car_rent_booking_details_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.customer_car_rent_booking_details
    ADD CONSTRAINT customer_car_rent_booking_details_pkey PRIMARY KEY (id);


--
-- Name: customer_cars_rent_price_details_type customer_cars_rent_price_details_type_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.customer_cars_rent_price_details_type
    ADD CONSTRAINT customer_cars_rent_price_details_type_pkey PRIMARY KEY (id);


--
-- Name: driver_job_request driver_job_request_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.driver_job_request
    ADD CONSTRAINT driver_job_request_pkey PRIMARY KEY (id);


--
-- PostgreSQL database dump complete
--

